<link rel="import" href="../../lib/grapp-rest-resource/grapp-rest-resource.html">
<link rel="import" href="../../lib/grapp-breadcrumbs/grapp-breadcrumbs.html">
<link rel="import" href="../coyoho-i18n/coyoho-i18n.html">
<link rel="import" href="../coyoho-data-table/coyoho-data-table.html">
<link rel="import" href="../coyoho-select/coyoho-select.html">

<polymer-element name="coyoho-rooms-list">

  <template>

    <grapp-rest-resource url="/buildings/:buildingId/floors/:floorId/rooms/:id?q={{searchText}}"
                         params='{{ {"buildingId":buildingId, "floorId":floorId} }}'
                         resource="{{rooms}}"></grapp-rest-resource>

    <core-ajax id="buildingsNames" url="/buildings/names" handleAs="json" response="{{buildingsNames}}">
    </core-ajax>

    <core-ajax id="floorsNames" url="/buildings/{{buildingId}}/floors/names" handleAs="json"
               response="{{floorsNames}}">
    </core-ajax>

    <grapp-app-globals>
      <grapp-app-global-value name="appTitle" value="models.room.other"></grapp-app-global-value>
      <grapp-app-global-value name="appModule" value="manage"></grapp-app-global-value>
      <grapp-app-global-value name="appFunction" value="rooms"></grapp-app-global-value>
    </grapp-app-globals>

    <grapp-breadcrumbs>
      <grapp-breadcrumb href="/#/buildings">{{'models.building.other'|i18n}}</grapp-breadcrumb>
      <grapp-breadcrumb href="/#/buildings/{{buildingId}}">{{buildingsNames | nameOfBuilding(buildingId)}}</grapp-breadcrumb>
      <grapp-breadcrumb href="/#/buildings/{{buildingId}}/floors">{{'models.floor.other'|i18n}}</grapp-breadcrumb>
      <grapp-breadcrumb href="/#/buildings/{{buildingId}}/floors/{{id}}">{{floorsNames | nameOfFloor(floorId)}}</grapp-breadcrumb>
      <grapp-breadcrumb href="/#/buildings/{{buildingId}}/floors/{{id}}/rooms">{{'models.room.other'|i18n}}</grapp-breadcrumb>
    </grapp-breadcrumbs>

    <coyoho-data-table id="table" model="room" resource="{{rooms}}" searchText="{{searchText}}"
                       on-data-table-edit="{{edit}}" on-data-table-new="{{new}}">

      <coyoho-data-column name="number" width="30"></coyoho-data-column>
      <coyoho-data-column name="description" width="70"></coyoho-data-column>

      <coyoho-toolbar-extension>
        <coyoho-select items="{{buildingsNames}}" selectedId="{{buildingId}}"
                       placeholder="{{'models.building.one'|i18n}}..."></coyoho-select>
        <coyoho-select items="{{floorsNames}}" selectedId="{{floorId}}"
                       placeholder="{{'models.floor.one'|i18n}}..."></coyoho-select>
      </coyoho-toolbar-extension>

    </coyoho-data-table>

  </template>

  <script src="coyoho-rooms-list.js"></script>

</polymer-element>
