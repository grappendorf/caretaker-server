<link rel="import" href="../../web_lib/paper-toast/paper-toast.html">
<link rel="import" href="../../web_lib/grapp-core-ajax/grapp-core-ajax.html">
<link rel="import" href="../../web_lib/grapp-dialogs/grapp-confirmation-dialog.html">
<link rel="import" href="../caretaker-websocket/caretaker-websocket.html">
<link rel="import" href="caretaker-controlpanel-widget.html">
<link rel="import" href="widgets/caretaker-widget-cipcamdevice.html">
<link rel="import" href="widgets/caretaker-widget-dimmerdevice.html">
<link rel="import" href="widgets/caretaker-widget-dimmerrgbdevice.html">
<link rel="import" href="widgets/caretaker-widget-remotecontroldevice.html">
<link rel="import" href="widgets/caretaker-widget-reflowovendevice.html">
<link rel="import" href="widgets/caretaker-widget-switchdevice.html">
<link rel="import" href="widgets/caretaker-widget-sensordevice.html">
<link rel="import" href="widgets/caretaker-widget-weather.html">
<link rel="import" href="dialogs/caretaker-controlpanel-new-dashboard-dialog.html">
<link rel="import" href="dialogs/caretaker-controlpanel-edit-dashboard-dialog.html">
<link rel="import" href="dialogs/caretaker-controlpanel-new-widget-dialog.html">
<link rel="import" href="dialogs/caretaker-controlpanel-edit-widget-dialog.html">

<polymer-element name="caretaker-controlpanel" attributes="token">

  <template>

    <link href="../../stylesheets/bootstrap.css" rel="stylesheet">
    <link href="caretaker-controlpanel.css" rel="stylesheet">

    <grapp-app-globals id="globals"></grapp-app-globals>

    <div class="row">
      <div class="col-md-12">

        <div class="btn-toolbar">
          <div class="btn-group">
            <caretaker-select items="{{dashboardNames}}" selectedId="{{dashboardId}}"></caretaker-select>
            <button on-click="{{editDashboard}}" disabled?="{{! dashboard}}" class="btn btn-primary">
              <grapp-fa-icon icon="edit"></grapp-fa-icon>
            </button>
            <a class="btn btn-primary" href="/#/dashboards">
              <grapp-fa-icon icon="list"></grapp-fa-icon>
            </a>
          </div>
          <div class="btn-group">
            <button on-click="{{reloadDashboard}}" disabled?="{{! dashboard}}" class="btn btn-info">
              <grapp-fa-icon icon="refresh" spin="{{state == 'loading'}}"></grapp-fa-icon>
              {{'action.reload_dashboard' | i18n}}
            </button>
          </div>
          <div class="btn-group">
            <button on-click="{{newWidget}}" disabled?="{{! dashboard}}" class="btn btn-success">
              <grapp-fa-icon icon="plus"></grapp-fa-icon>
              {{'action.add_widget' | i18n}}
            </button>
          </div>
          <div class="btn-group">
            <button on-click="{{newDashboard}}" class="btn btn-warning">
              <grapp-fa-icon icon="asterisk"></grapp-fa-icon>
              {{'action.new_dashboard' | i18n}}
            </button>
            <button on-click="{{deleteDashboard}}" disabled?="{{! dashboard}}" class="btn btn-danger">
              <grapp-fa-icon icon="trash-o"></grapp-fa-icon>
              {{'action.delete_dashboard' | i18n}}
            </button>
          </div>
        </div>

      </div>
    </div>

    <div id="widgets" horizontal layout wrap hidden?="{{dashboard.widgets.length === 0}}"
         on-edit-widget-properties="{{editWidgetProperties}}"
         on-delete-widget="{{deleteWidget}}">
      <template repeat="{{widget in dashboard.widgets}}">
        <caretaker-controlpanel-widget type="{{widget.type}}" widget="{{widget}}" width="{{widget.width}}" height="{{widget.height}}">
          <template bind ref="{{widget.type}}"></template>
        </caretaker-controlpanel-widget>
      </template>
    </div>

    <template if="{{state === 'ok' && dashboard.widgets.length === 0}}">
      <div class="row">
        <div class="col-md-8 col-md-offset-4">

          <br>

          <div class="jumbotron">
            <h1>
              <grapp-fa-icon icon="plus"></grapp-fa-icon>
              {{'title.add_widgets_to_your_dashboard' | i18n}}
            </h1>

            <p>{{'description.your_dashboard_is_empty' | i18n}}</p>

            <p>{{'description.add_widgets_to_your_dashboard' | i18n}}</p>

            <p>
              <a class="btn btn-success btn-lg" role="button" on-click="{{newWidget}}">
                <grapp-fa-icon icon="plus"></grapp-fa-icon>
                {{'action.add_widget' | i18n}}
              </a>
            </p>
          </div>

        </div>
      </div>
    </template>

    <template if="{{dashboardNames && dashboardNames.length === 0}}">
      <div class="row">
        <div class="col-md-8 col-md-offset-4">
          <div class="jumbotron">
            <h1>
              <grapp-fa-icon icon="th-large"></grapp-fa-icon>
              {{'title.create_a_dashboard' | i18n}}
            </h1>

            <p>{{'description.you_currently_have_no_dashboard' | i18n}}</p>

            <p>{{'description.create_your_first_dashboard' | i18n}}</p>

            <p>
              <a class="btn btn-success btn-lg" role="button" on-click="{{newDashboard}}">
                <grapp-fa-icon icon="plus"></grapp-fa-icon>
                {{'action.create_dashboard' | i18n}}
              </a>
            </p>
          </div>
        </div>
      </div>
    </template>

    <template if="{{state === 'error'}}">
      <div ng-if="" class="row">
        <div class="col-md-8 col-md-offset-2">

          <br>

          <div class="alert alert-danger">
            <p class="text-error">
              <grapp-fa-icon icon="warning"></grapp-fa-icon>
              {{'message.error_loading_dashboard' | i18n}}
            </p>
          </div>

        </div>
      </div>
    </template>

    <paper-toast id="toast" text="Event received: {{event}}" duration="2000">
    </paper-toast>

    <grapp-core-ajax id="defaultDashboardRequest" auto
                     url="/dashboards/default" method="GET" handleAs="json" token="{{token}}"
                     on-core-response="{{defaultDashboardSucceeded}}">
    </grapp-core-ajax>

    <grapp-core-ajax id="dashboardRequest"
                     url="/dashboards/{{dashboardId}}" method="GET" handleAs="json" token="{{token}}"
                     on-core-response="{{dashboardSucceeded}}" on-core-error="{{dashboardFailed}}">
    </grapp-core-ajax>

    <grapp-core-ajax id="dashboardNamesRequest"
                     url="/dashboards/names" method="GET" handleAs="json" token="{{token}}"
                     response="{{dashboardNames}}">
    </grapp-core-ajax>

    <grapp-rest-resource url="/dashboards/:id" resource="{{dashboards}}"
                         token="{{token}}"></grapp-rest-resource>

    <grapp-rest-resource url="/dashboards/:dashboardId/widgets/:id"
                         createUrl="/dashboards/:dashboardId/:type/:id"
                         updateUrl="/dashboards/:dashboardId/:type/:id"
                         params='{{ {"dashboardId":dashboardId, "type": "device_widgets"} }}'
                         resource="{{widgets}}" token="{{token}}"></grapp-rest-resource>

    <caretaker-websocket id="websocket">
      <caretaker-websocket-subscribe channel="devices">
        <caretaker-websocket-bind event="state" on-data="{{updateDeviceState}}"></caretaker-websocket-bind>
        <caretaker-websocket-bind event="connection" on-data="{{updateDeviceConnection}}"></caretaker-websocket-bind>
      </caretaker-websocket-subscribe>
    </caretaker-websocket>

    <caretaker-controlpanel-new-dashboard-dialog id="newDashboardDialog">
    </caretaker-controlpanel-new-dashboard-dialog>

    <caretaker-controlpanel-edit-dashboard-dialog id="editDashboardDialog"
                                                  dashboard="{{dashboard}}">
    </caretaker-controlpanel-edit-dashboard-dialog>

    <caretaker-controlpanel-new-widget-dialog id="newWidgetDialog" token="{{token}}">
    </caretaker-controlpanel-new-widget-dialog>

    <caretaker-controlpanel-edit-widget-dialog id="editWidgetDialog" token="{{token}}">
    </caretaker-controlpanel-edit-widget-dialog>

    <grapp-confirmation-dialog id="deleteConfirmDialog" heading="{{'title.delete_confirmation' | i18n}}" htmlMessage
                               yesLabel="{{'action.ok' | i18n}}" yesIcon="check"
                               noLabel="{{'action.cancel' | i18n}}" noIcon="close">
    </grapp-confirmation-dialog>

    <template id="CipcamDeviceWidget">
      <caretaker-widget-cipcamdevice id="content" widget="{{widget}}" websocket="{{$.websocket}}"
                                     token="{{token}}"></caretaker-widget-cipcamdevice>
    </template>

    <template id="DimmerDeviceWidget">
      <caretaker-widget-dimmerdevice id="content" widget="{{widget}}"
                                     websocket="{{$.websocket}}"></caretaker-widget-dimmerdevice>
    </template>

    <template id="DimmerRgbDeviceWidget">
      <caretaker-widget-dimmerrgbdevice id="content" widget="{{widget}}"
                                        websocket="{{$.websocket}}"></caretaker-widget-dimmerrgbdevice>
    </template>

    <template id="EasyvrDeviceWidget">
      <caretaker-widget-easyvrdevice id="content" widget="{{widget}}"
                                     websocket="{{$.websocket}}"></caretaker-widget-easyvrdevice>
    </template>

    <template id="SwitchDeviceWidget">
      <caretaker-widget-switchdevice id="content" widget="{{widget}}"
                                     websocket="{{$.websocket}}"></caretaker-widget-switchdevice>
    </template>

    <template id="RemoteControlDeviceWidget">
      <caretaker-widget-remotecontroldevice id="content" widget="{{widget}}"
                                            websocket="{{$.websocket}}"></caretaker-widget-remotecontroldevice>
    </template>

    <template id="ReflowOvenDeviceWidget">
      <caretaker-widget-reflowovendevice id="content" widget="{{widget}}"
                                         websocket="{{$.websocket}}"></caretaker-widget-reflowovendevice>
    </template>

    <template id="SensorDeviceWidget">
      <caretaker-widget-sensordevice id="content" widget="{{widget}}"
                                         websocket="{{$.websocket}}"></caretaker-widget-sensordevice>
    </template>

    <template id="WeatherWidget">
      <caretaker-widget-weather id="content" widget="{{widget}}"></caretaker-widget-weather>
    </template>

  </template>

  <script src="../../web_lib/classie/classie.js"></script>
  <script src="../../web_lib/get-style-property/get-style-property.js"></script>
  <script src="../../web_lib/get-size/get-size.js"></script>
  <script src="../../web_lib/eventie/eventie.js"></script>
  <script src="../../web_lib/eventEmitter/EventEmitter.js"></script>
  <script src="../../web_lib/matches-selector/matches-selector.js"></script>
  <script src="../../web_lib/draggabilly/draggabilly.js"></script>
  <script src="../../web_lib/doc-ready/doc-ready.js"></script>
  <script src="../../web_lib/outlayer/item.js"></script>
  <script src="../../web_lib/outlayer/outlayer.js"></script>
  <script src="../../web_lib/packery/js/rect.js"></script>
  <script src="../../web_lib/packery/js/packer.js"></script>
  <script src="../../web_lib/packery/js/item.js"></script>
  <script src="../../web_lib/packery/js/packery.js"></script>
  <script src="caretaker-controlpanel.js"></script>

</polymer-element>
