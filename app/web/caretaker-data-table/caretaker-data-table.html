<link rel="import" href="../../web_lib/grapp-fa-icon/grapp-fa-icon.html">
<link rel="import" href="../../web_lib/grapp-paper-button/grapp-paper-button.html">
<link rel="import" href="../../web_lib/grapp-dialogs/grapp-confirmation-dialog.html">
<link rel="import" href="../caretaker-i18n/caretaker-i18n.html">
<link rel="import" href="caretaker-data-column.html">
<link rel="import" href="caretaker-data-action.html">

<polymer-element name="caretaker-data-table"
                 attributes="data resource model router searchText realtimeSearch titleAttribute">

  <template>

    <link href="../../stylesheets/bootstrap.css" rel="stylesheet">
    <link href="caretaker-data-table.css" rel="stylesheet">

    <div id="toolbar" layout horizontal>

      <div class="btn-group">
        <button class="btn btn-default" type="button" on-tap="{{new}}">
          <grapp-fa-icon icon="asterisk"></grapp-fa-icon>
        </button>
      </div>

      <content select="caretaker-toolbar-extension"></content>

      <div class="input-group">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button" on-tap="{{search}}">
            <grapp-fa-icon icon="search"></grapp-fa-icon>
          </button>
				</span>
        <input name="q" type="search" class="form-control form-search-input"
               placeholder="{{'placeholder.search' | i18n}}" value="{{searchText}}"
               on-keypress="{{onSearchKeyPress}}">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button" on-tap="{{clearSearch}}">
            <grapp-fa-icon icon="times-circle-o"></grapp-fa-icon>
          </button>
				</span>
      </div>

      <span flex></span>

    </div>

    <table class="table table-bordered table-striped table-hover">
      <thead>
        <tr>
          <th class="width-0">
          </th>
          <template repeat="{{column in columns}}">
            <th class="{{column.thClass}}">
              <template if="{{column.icon}}">
                <grapp-fa-icon icon="{{column.icon}}"></grapp-fa-icon>
              </template>
              {{column.heading}}
            </th>
          </template>
          <th class="width-0">
          </th>
        </tr>
      </thead>
      <tbody>
        <template repeat="{{item in data}}">
          <tr data-item-id="{{item.id}}">
            <td>
              <nobr>
                <grapp-fa-icon icon="edit" on-tap="{{edit}}"></grapp-fa-icon>
                <template repeat="{{action in actions}}">
                  <grapp-fa-icon icon="{{action.icon}}" on-tap="{{fireAction}}"
                                 data-item-id="{{item.id}}"></grapp-fa-icon>
                </template>
              </nobr>
            </td>
            <template repeat="{{column in columns}}">
              <td class="{{column.tdClass}}" on-tap="{{cellTapped}}">
                <template if="{{column.type === 'string'}}">
                  {{item | attribute(column.name)}}
                </template>
                <template if="{{column.type === 'check'}}">
                  <grapp-fa-icon icon="{{item | attributeCheckIcon(column.name)}}"></grapp-fa-icon>
                </template>
                <template if="{{column.type === 'date'}}">
                  {{item | attribute(column.name) | i18n_time('short')}}
                </template>
                <template if="{{column.type === 'list'}}">
                  {{item | attributeList(column.name)}}
                </template>
                <template if="{{column.type === 'template'}}">
                  <template bind="{{item}}" ref="column-{{column.name}}"></template>
                </template>
              </td>
            </template>
            <td>
              <grapp-fa-icon icon="trash-o" on-tap="{{delete}}"></grapp-fa-icon>
            </td>
          </tr>
        </template>
      </tbody>
    </table>

    <grapp-confirmation-dialog id="deleteConfirmation" heading="{{'title.delete_confirmation' | i18n}}" htmlMessage
                               yesLabel="{{'action.ok' | i18n}}" yesIcon="check"
                               noLabel="{{'action.cancel' | i18n}}" noIcon="close"></grapp-confirmation-dialog>

    <caretaker-i18n id="i18n"></caretaker-i18n>

  </template>

  <script src="caretaker-data-table.js"></script>

</polymer-element>
