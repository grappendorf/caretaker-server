<link rel="import" href="../../web_lib/paper-input/paper-input.html">
<link rel="import" href="../../web_lib/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../web_lib/grapp-fa-icon/grapp-fa-icon.html">
<link rel="import" href="../../web_lib/grapp-paper-button/grapp-paper-button.html">
<link rel="import" href="../../web_lib/grapp-paper-input/grapp-paper-input.html">
<link rel="import" href="../../web_lib/grapp-paper-fab/grapp-paper-fab.html">
<link rel="import" href="../caretaker-codemirror-input/caretaker-codemirror-input.html">
<link rel="import" href="../caretaker-i18n/caretaker-i18n.html">
<link rel="import" href="caretaker-data-field.html">
<link rel="import" href="caretaker-data-fieldset.html">

<polymer-element name="caretaker-data-editor" attributes="resource model header">

  <template>

    <link href="../../stylesheets/bootstrap.css" rel="stylesheet">
    <link href="caretaker-data-editor.css" rel="stylesheet">

    <template if="{{item}}">

      <template if="{{item[header]}}">
        <div id="header" horizontal layout>
          <div class="col-md-offset-2 col-md-6">{{item[header]}}&nbsp;</div>
        </div>
      </template>

      <form id="content" class="form-horizontal" role="form">

        <template repeat="{{fieldset in fieldsets}}">

          <fieldset>

            <template if="{{fieldset.label || fieldset.icon || fieldset.image}}">
              <legend>
                <template if="{{fieldset.icon}}">
                  <grapp-fa-icon icon="{{fieldset.icon}}"></grapp-fa-icon>
                </template>
                <template if="{{fieldset.image}}">
                  <img src="{{fieldset.image}}"></grapp-fa-icon>
                </template>
                <template if="{{fieldset.label}}">
                  {{fieldset.label}}
                </template>
              </legend>
            </template>

            <template if="{{fieldset.fields.length === 0}}">
              <label class="col-md-7 col-md-offset-1">
                {{'description.there_are_no_fields_for_this_fieldset' | i18n}}
              </label>
            </template>

            <template repeat="{{field in fieldset.fields}}">
              <div class="{{ {'form-group': true, 'has-error': field.error !== null} | tokenList}}">

                <label for="{{field.name}}" class="control-label col-md-2">{{field.label}}</label>

                <template if="{{field.type === 'string'}}">
                  <div class="col-md-6">
                    <input id="{{field.name}}" class="form-control" value="{{item[field.name]}}"
                           on-input="{{validate}}">
                  </div>
                </template>
                <template if="{{field.type === 'check'}}">
                  <div class="col-md-6">
                    <div class="check-input"><input id="{{field.name}}" type="checkbox"></div>
                  </div>
                </template>
                <template if="{{field.type === 'text'}}">
                  <div class="col-md-6">
                    <textarea id="{{field.name}}" class="form-control" rows="3"
                              on-input="{{validate}}" value="{{item[field.name]}}"></textarea>
                  </div>
                </template>
                <template if="{{field.type === 'code'}}">
                  <div class="col-md-8">
                    <caretaker-codemirror-input id="{{field.name}}" rows="3" mode="ruby" on-input="{{validate}}"
                                                value="{{item[field.name]}}">
                    </caretaker-codemirror-input>
                  </div>
                </template>

                <template if="{{field.error}}">
                  <span class="help-block">{{field.error}}</span>
                </template>
              </div>

              </div>
            </template>

          </fieldset>

        </template>

      </form>

      <div id="footer">
        <div class="col-md-2">
        </div>
        <div class="col-md-6">

          <grapp-paper-button raised success disabled?="{{! modified || !valid}}"
                              on-click="{{save}}" on-enter="{{save}}">
            <grapp-fa-icon icon="{{ {check: !processing, spinner: processing} | tokenList}}"
                           spin="{{processing}}"></grapp-fa-icon>
            &nbsp;{{'action.save' | i18n}}
          </grapp-paper-button>

          <grapp-paper-button raised error on-click="{{cancel}}">
            <grapp-fa-icon icon="close"></grapp-fa-icon>
            &nbsp;{{'action.cancel' | i18n}}
          </grapp-paper-button>

        </div>
      </div>
    </template>

    <caretaker-i18n id="i18n"></caretaker-i18n>

  </template>

  <script src="caretaker-data-editor.js"></script>

</polymer-element>
